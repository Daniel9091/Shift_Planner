<h1>Global</h1>

<p>Modo: <%= @current_mode %></p>
<%= link_to @button_text, global_path(mode: @new_mode), class: 'btn btn-primary' %>

<% @active_itineraries.each do |itinerary| %>
  <div class="card mb-3">
    <div class="card-body">
      <h2 class="card-title">Itinerario: <%= itinerary.day %></h2>
      <% if itinerary.status == 'Piloto' %>
        <p class="card-text">Eres piloto.</p>
      <% else %>
        <% filtered_groups = filter_groups(itinerary, @current_mode) %>
        <ul>
          <% filtered_groups.each do |group| %>
            <div class="group-info">
            <li><strong>Día del Grupo:</strong> <%= group.day %></li>
            <li><strong>Hora de Salida:</strong> <%= group.h_start %></li>
            <li><strong>Hora de Llegada:</strong> <%= group.h_end %></li>
            <li><strong>Costo:</strong> <%= group.cost %></li>
            <li><strong>Lugar de Salida:</strong> <%= group.starting_place.name %></li>
            <li><strong>Lugar de Llegada:</strong> <%= group.ending_place.name %></li>
            <p>Personas unidas al grupo: <%= group.users.count %> / <%= group.n_seats %></p>
              <% if group.users.include?(current_user) %>
                <p>Ya estás unido a este grupo.</p>
              <% elsif group.users.count >= group.n_seats.to_i %>
                <p>Este grupo está lleno.</p>
              <% else %>
                <%= form_with url: join_group_path(group), method: :post, local: true do %>
                  <%= hidden_field_tag :mode, @mode %>
                  <%= submit_tag 'Unirse al grupo', class: 'btn btn-primary' %>
                <% end %>
              <% end %>
            </div>
          <% end %>
        </ul>
      <% end %>
    </div>
  </div>
<% end %>

<%= render 'shared/navbar' %>

<div class="container mt-4">
  <%= yield %>
</div>
