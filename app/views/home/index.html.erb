<!DOCTYPE html>
<html>
<head>
  <title>Perfil de Usuario</title>
  <%= stylesheet_link_tag 'https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css' %>
  <style>
    .calendar {
      display: grid;
      grid-template-columns: repeat(8, 1fr);
      grid-template-rows: repeat(29, 1fr);
      gap: 1px;
      margin-top: 20px;
      background-color: #ddd;
    }
    .calendar .header, .calendar .time, .calendar .day {
      background-color: #f8f9fa;
      padding: 10px;
      text-align: center;
    }
    .calendar .day {
      background-color: #fff;
    }
    .calendar .itinerary {
      background-color: #007bff;
      color: white;
      padding: 10px;
      box-sizing: border-box;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
    }
  </style>
</head>
<body>
  <div class="container">
    <% if @user %>
      <div class="profile my-4" id="perfil">
        <h1>Perfil de Usuario</h1>
        <p><strong>Nombre de usuario:</strong> <%= @user.name %></p>
        <p><strong>Email:</strong> <%= @user.email %></p>
        <p><strong>Teléfono:</strong> <%= @user.phone %></p>
        <p><strong>Descripción:</strong> <%= @user.description %></p>
        <p><strong>Datos:</strong> <%= @user.data %></p>
      </div>

      <div class="itineraries my-4" id="viaje">
        <h2>Itinerarios</h2>
        <div class="calendar">
          <!-- Calendar Header -->
          <div class="header"></div>
          <% %w[Lunes Martes Miércoles Jueves Viernes Sábado Domingo].each do |day| %>
            <div class="header"><%= day %></div>
          <% end %>

          <!-- Calendar Time Slots -->
          <% (7..21).each do |hour| %>
            <% ["00", "30"].each do |minute| %>
              <div class="time"><%= "#{hour}:#{minute}" %></div>
              <% 7.times do %>
                <div class="day"></div>
              <% end %>
            <% end %>
          <% end %>

          <!-- Mark Itineraries in the Calendar -->
          <% if @itineraries.any? %>
            <% @itineraries.each do |itinerary| %>
              <% start_pos = time_to_grid_position(itinerary.h_start) %>
              <% end_pos = time_to_grid_position(itinerary.h_end) %>
              <% col_pos = day_to_grid_column(itinerary.day) %>
              <div class="itinerary" style="grid-row: <%= start_pos %> / <%= end_pos %>; grid-column: <%= col_pos %>;">
                <p><strong>Inicio:</strong> <%= itinerary.h_start %></p>
                <p><strong>Fin:</strong> <%= itinerary.h_end %></p>
              </div>
            <% end %>
          <% end %>
        </div>

        <% if @itineraries.any? %>
          <% @itineraries.each do |itinerary| %>
            <div class="itinerary mt-3">
              <p><strong>Status:</strong> <%= itinerary.status %></p>
              <p><strong>Día:</strong> <%= itinerary.day %></p>
              <p><strong>Hora de inicio:</strong> <%= itinerary.h_start %></p>
              <p><strong>Hora de fin:</strong> <%= itinerary.h_end %></p>
              <p><strong>Lugar de inicio:</strong> <%= itinerary.starting_place&.name || 'No asignado' %></p>
              <p><strong>Lugar de fin:</strong> <%= itinerary.ending_place&.name || 'No asignado' %></p>
              <% if itinerary.status == 'Piloto' %>
                <div class="new-section-group-btn mt-2">
                  <%= link_to 'Crear nuevo viaje', new_section_group_path(itinerary_id: itinerary.id), class: 'btn btn-secondary' %>
                </div>
              <% end %>
            </div>
          <% end %>
        <% else %>
          <p>No tienes itinerarios registrados.</p>
        <% end %>

        <div class="new-itinerary-btn mt-3">
          <%= link_to 'Crear nuevo itinerario', new_itinerary_path, class: 'btn btn-primary' %>
        </div>
      </div>
    <% else %>
      <p>No se ha encontrado el usuario.</p>
    <% end %>
  </div>

  <%= render 'shared/navbar' %>

  <div class="container mt-4">
    <%= yield %>
  </div>

  <%= javascript_include_tag 'application', 'data-turbolinks-track': 'reload' %>
  <%= javascript_include_tag 'https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js' %>
</body>
</html>
